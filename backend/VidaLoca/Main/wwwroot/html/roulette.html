<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>VidaLoca — Roulette</title>
  <link rel="stylesheet" href="../css/style.css?v=20251226" />
    <!-- Inline fallback styles to ensure pointer/table visible while debugging -->
    <style>
      /* fallback pointer */
  .wheel-edge { position:absolute; top:0; left:50%; transform:translate(-50%,-40%); width:0; height:0; border-left:28px solid transparent; border-right:28px solid transparent; border-bottom:56px solid #d30000; z-index:99999; box-shadow:0 6px 12px rgba(0,0,0,0.6); }
  .wheel-edge.inverted { transform: translate(-50%,6%) rotate(180deg); top: auto; bottom: 0; }
      .wheel-pointer { display:block; }
      /* betting area fallback visuals */
      .bets-card { background:#0f0f10; color:#fff; border:1px solid rgba(255,255,255,0.06); padding:12px; border-radius:10px; }
      .bet-grid { display:grid; grid-template-columns: repeat(3,1fr); gap:6px; margin-top:8px; }
  .bet-cell { background:#151515; color:#fff; border:1px solid rgba(255,255,255,0.04); padding:8px 6px; border-radius:6px; text-align:center; min-height:40px; }
      .bet-cell-zero { grid-column: 1 / -1; font-weight:700; }
  .badge { background:#fff; color:#111; padding:2px 6px; border-radius:10px; font-size:0.8rem; margin-left:6px; border:1px solid rgba(0,0,0,0.06); }
  /* default fallback: bet numbers shown white as requested */
  .bet-cell .num { color: #fff; }
  /* chip buttons fallback: labels white */
  .chip { color: #fff; background: #222; border: 1px solid rgba(255,255,255,0.04); padding:6px 10px; border-radius:8px; }
  .bet-cell.bet-placed .badge { background: #2e7d32; color: #e8f5e9; }
    </style>
    <script>
      // quick DOM check and inline-style fallback to ensure visual elements render
      window.addEventListener('DOMContentLoaded', ()=>{
        try{
          console.log('roulette debug:', {
            wheelEdge: !!document.querySelector('.wheel-edge'),
            wheelCanvas: !!document.getElementById('roulette'),
            betGrid: !!document.getElementById('betGrid'),
            betsCard: !!document.querySelector('.bets-card')
          });

          // Force the top pointer triangle inline so it shows even if stylesheet is cached
          const pointer = document.querySelector('.wheel-pointer');
          if(pointer){
            pointer.style.position = 'absolute';
            pointer.style.top = '-48px';
            pointer.style.left = '50%';
            pointer.style.transform = 'translateX(-50%) rotate(180deg)';
            pointer.style.width = '0';
            pointer.style.height = '0';
            pointer.style.borderLeft = '36px solid transparent';
            pointer.style.borderRight = '36px solid transparent';
            pointer.style.borderBottom = '72px solid #d30000';
            pointer.style.zIndex = '99999';
            pointer.style.boxShadow = '0 8px 16px rgba(0,0,0,0.5)';
            pointer.style.display = 'block';
          }

          // Make bet number labels white inline (user requested) to override stale CSS
          document.querySelectorAll('.bet-cell .num').forEach(n=>{
            n.style.color = '#fff';
            n.style.fontWeight = '600';
          });

          // Make chip labels clearly white
          document.querySelectorAll('.chip').forEach(c=>{
            c.style.color = '#fff';
            c.style.background = '#222';
            c.style.border = '1px solid rgba(255,255,255,0.04)';
          });

          // Ensure empty badges look like white placeholders
          document.querySelectorAll('.bet-cell .badge').forEach(b=>{
            if(!b.innerText || b.innerText.trim()===''){
              b.style.background = '#fff';
              b.style.color = '#111';
              b.style.border = '1px solid rgba(0,0,0,0.06)';
            }
          });

        }catch(e){ console.error('debug check failed', e); }
      });
    </script>
  </head>
  <body>
    <header class="site-header">
      <div class="container center">
        <h1 class="site-title">VidaLoca</h1>
      </div>
    </header>

    <main class="container home-main center">
      <div class="roulette-wrap">
        <section class="wheel-area">
          <div class="wheel-stage">
            <canvas id="roulette" width="520" height="520" aria-label="Roulette wheel"></canvas>
            <div class="wheel-pointer"></div>
          </div>
          <div class="controls">
            <button id="spinBtn" class="btn btn-primary">Spin</button>
            <button id="resetBtn" class="btn btn-ghost">Reset Bets</button>
            <p id="result" class="small muted mt-1">Place your bets and spin the wheel.</p>
          </div>
        </section>

        <aside class="bets-area">
          <div class="bets-card">
            <h3>Betting Table</h3>
            <div class="chips-row">
              <button class="chip" data-value="1">1</button>
              <button class="chip" data-value="5">5</button>
              <button class="chip" data-value="10">10</button>
              <button class="chip" data-value="25">25</button>
            </div>

            <div class="bet-grid" id="betGrid" aria-label="Betting grid">
              <!-- numbers 0-36 will be generated by script -->
            </div>

            <div class="mt-1">
              <button id="placeBetBtn" class="btn btn-primary">Place Selected Bet</button>
            </div>
            <div class="mt-1">
              <a class="btn btn-ghost" href="/html/games.html">Back to Games</a>
            </div>
          </div>
        </aside>
      </div>
    </main>

    <footer class="site-footer center">
      <div class="container">
        <p class="small">© 2025 VidaLoca — All rights reserved</p>
      </div>
    </footer>
    <script>
      // Simple roulette wheel logic (visual + basic bets)
      (function(){
        const canvas = document.getElementById('roulette');
        const ctx = canvas.getContext('2d');
        const size = Math.min(canvas.width, canvas.height);
        const center = { x: canvas.width/2, y: canvas.height/2 };
        const radius = size/2 - 6;

        // European roulette sequence (single zero)
        const numbers = [0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26];
        const colors = { red: '#d32f2f', black: '#111', green: '#1b5e20' };

        function drawWheel(rotation=0){
          ctx.clearRect(0,0,canvas.width,canvas.height);
          const slice = (2*Math.PI) / numbers.length;
          ctx.save();
          ctx.translate(center.x, center.y);
          ctx.rotate(rotation);

          for(let i=0;i<numbers.length;i++){
            const start = i*slice;
            const end = start + slice;
            // choose color
            const n = numbers[i];
            const color = n === 0 ? colors.green : (isRed(n) ? colors.red : colors.black);
            ctx.beginPath();
            ctx.moveTo(0,0);
            ctx.arc(0,0,radius,start,end);
            ctx.closePath();
            ctx.fillStyle = color;
            ctx.fill();
            // border
            ctx.strokeStyle = '#222';
            ctx.lineWidth = 2;
            ctx.stroke();

            // number label
            ctx.save();
            ctx.rotate(start + slice/2);
            ctx.translate(radius*0.65,0);
            ctx.rotate(Math.PI/2);
            ctx.fillStyle = '#fff';
            ctx.font = '18px Inter, system-ui, -apple-system, Roboto, Arial';
            ctx.textAlign = 'center';
            ctx.fillText(String(n), 0, 0);
            ctx.restore();
          }

          // center hub
          ctx.beginPath();
          ctx.arc(0,0,44,0,2*Math.PI);
          ctx.fillStyle = '#222';
          ctx.fill();
          ctx.restore();
        }

        function isRed(n){
          // red numbers set from standard roulette
          const reds = new Set([1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36]);
          return reds.has(n);
        }

        // initial draw
        drawWheel(0);

  // bets UI
  const betGrid = document.getElementById('betGrid');
  if(!betGrid) console.warn('betGrid element not found; betting UI will not initialize');
        const chips = Array.from(document.querySelectorAll('.chip'));
        let selectedChip = null;
        let pendingBets = {}; // number -> amount

        function createBetCells(){
          // create 0 cell as a wide top cell
          const zeroBtn = document.createElement('button');
          zeroBtn.className = 'bet-cell bet-cell-zero';
          zeroBtn.dataset.num = '0';
          zeroBtn.innerHTML = '<span class="num">0</span><span class="badge" aria-hidden="true"></span>';
          zeroBtn.addEventListener('click', () => applyBetToCell(zeroBtn, 0));
          betGrid.appendChild(zeroBtn);

          // create numbers 1..36 in 3 columns layout visually (we rely on CSS)
          for(let i=1;i<=36;i++){
            const btn = document.createElement('button');
            btn.className = 'bet-cell';
            btn.dataset.num = String(i);
            const colorClass = isRed(i) ? 'num-red' : 'num-black';
            btn.innerHTML = `<span class="num ${colorClass}">${i}</span><span class="badge" aria-hidden="true"></span>`;
            btn.addEventListener('click', ()=> applyBetToCell(btn, i));
            betGrid.appendChild(btn);
          }
        }

        function applyBetToCell(cell, number){
          if(!betGrid) return;
          if(!selectedChip) return;
          const val = parseInt(selectedChip.dataset.value,10);
          pendingBets[number] = (pendingBets[number]||0) + val;
          cell.classList.add('bet-placed');
          const b = cell.querySelector('.badge');
          if(b) {
            b.innerText = pendingBets[number];
            // ensure visual even if CSS cached
            b.style.background = '#2e7d32';
            b.style.color = '#e8f5e9';
          }
        }
        createBetCells();

        chips.forEach(c=> c.addEventListener('click', ()=>{
          chips.forEach(x=> x.classList.remove('chip-selected'));
          c.classList.add('chip-selected');
          selectedChip = c;
        }));

        document.getElementById('placeBetBtn').addEventListener('click', ()=>{
          document.getElementById('result').innerText = 'Bets placed: ' + Object.keys(pendingBets).length;
        });

        document.getElementById('resetBtn').addEventListener('click', ()=>{
          pendingBets = {};
          document.querySelectorAll('.bet-cell').forEach(b=>{
            b.classList.remove('bet-placed');
            const badge = b.querySelector('.badge');
            if(badge) {
              badge.innerText='';
              badge.style.background = '#fff';
              badge.style.color = '#111';
              badge.style.border = '1px solid rgba(0,0,0,0.06)';
            }
            delete b.dataset.amount;
          });
          document.getElementById('result').innerText = 'Bets reset.';
        });

        // Spin animation: rotate to a random target number
        const spinBtn = document.getElementById('spinBtn');
        let spinning = false;
        spinBtn.addEventListener('click', ()=>{
          if(spinning) return;
          spinning = true;
          const spins = 6 + Math.floor(Math.random()*6); // full rotations
          const winningIndex = Math.floor(Math.random()*numbers.length);
          const slice = (2*Math.PI) / numbers.length;
          // we want pointer at top (angle -PI/2), wheel rotated so slice center aligns
          const targetRotation = ( - (winningIndex + 0.5) * slice ) + (-Math.PI/2);
          const start = 0;
          const duration = 3500 + Math.random()*1200;
          const final = targetRotation - (spins * 2*Math.PI);

          const startTime = performance.now();
          function animate(now){
            const t = Math.min(1, (now - startTime)/duration);
            // ease out cubic
            const eased = 1 - Math.pow(1-t,3);
            const current = start + (final - start) * eased;
            drawWheel(current);
            if(t < 1) requestAnimationFrame(animate);
            else {
              spinning = false;
              const winNum = numbers[winningIndex];
              document.getElementById('result').innerText = 'Result: ' + winNum;
              // highlight winning cell
              document.querySelectorAll('.bet-cell').forEach(b=> b.classList.toggle('bet-win', parseInt(b.dataset.num,10)===winNum));
            }
          }
          requestAnimationFrame(animate);
        });

      })();
    </script>
  </body>
</html>
